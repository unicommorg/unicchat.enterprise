# Nginx + Let's Encrypt SSL –¥–ª—è UnicChat Enterprise

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Nginx —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ —á–µ—Ä–µ–∑ Let's Encrypt –¥–ª—è 3 –¥–æ–º–µ–Ω–æ–≤ UnicChat.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** (–≤–µ—Ä—Å–∏—è 20.10+)
- **Docker Compose** (–≤–µ—Ä—Å–∏—è 2.0+ plugin –∏–ª–∏ 1.29+ standalone)
- **–ü—Ä–∞–≤–∞ root** –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ `sudo`
- **3 DNS –∏–º–µ–Ω–∏** (A-–∑–∞–ø–∏—Å–∏), —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞:
  - `app.domain.com` - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ UnicChat
  - `edt.domain.com` - DocumentServer (OnlyOffice)
  - `minio.domain.com` - MinIO S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã**: 80, 443 –≤ firewall
- **Email** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Let's Encrypt

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Docker

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker
docker --version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker Compose
docker compose version
# –∏–ª–∏
docker-compose --version
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
nginx/
‚îú‚îÄ‚îÄ docker-compose.yml          # Nginx + Certbot –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
‚îú‚îÄ‚îÄ generate_ssl.sh             # –°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è SSL –∏ Nginx
‚îú‚îÄ‚îÄ .gitignore                  # –ò—Å–∫–ª—é—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îú‚îÄ‚îÄ README.md                   # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ config/                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è 3 –¥–æ–º–µ–Ω–æ–≤ (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ ssl/                        # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ options-ssl-nginx.conf  # SSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Mozilla (–≤ git)
‚îÇ   ‚îú‚îÄ‚îÄ ssl-dhparams.pem        # DH parameters (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è, –Ω–µ –≤ git)
‚îÇ   ‚îî‚îÄ‚îÄ live/                   # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt (–Ω–µ –≤ git)
‚îÇ       ‚îî‚îÄ‚îÄ app.domain.com/
‚îî‚îÄ‚îÄ www/                        # Challenge —Ñ–∞–π–ª—ã Let's Encrypt (–Ω–µ –≤ git)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∏–º–µ–Ω

DNS –∏–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã **–¥–æ** –∑–∞–ø—É—Å–∫–∞ —ç—Ç–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ —á–µ—Ä–µ–∑ –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `unicchat.sh`:

```bash
cd /path/to/unicchat.enterprise
sudo ./unicchat.sh

# –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ:
# [2] Setup DNS names for services (APP, EDT, MinIO)

# –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ 3 DNS –∏–º–µ–Ω–∏:
# - APP_DNS: app.domain.com
# - EDT_DNS: edt.domain.com  
# - MINIO_DNS: minio.domain.com
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª `../dns_config.txt` —Å –≤–∞—à–∏–º–∏ DNS –∏–º–µ–Ω–∞–º–∏.

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ 3 –¥–æ–º–µ–Ω–∞ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
dig app.domain.com +short
dig edt.domain.com +short
dig minio.domain.com +short

# –í—Å–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall

```bash
# –î–ª—è UFW
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo ufw status
```

### –®–∞–≥ 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ SSL –∏ Nginx

```bash
cd /path/to/unicchat.enterprise/nginx
sudo ./generate_ssl.sh

# –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ:
# [99] üöÄ –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (SSL + nginx)

# –í–≤–µ–¥–∏—Ç–µ email –¥–ª—è Let's Encrypt (–µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ä–∞–Ω–µ–µ)
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ `options-ssl-nginx.conf` (–≤–∫–ª—é—á–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
2. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç DH parameters 2048 bit (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
3. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç nginx (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)
4. ‚úÖ –ü–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –≤—Å–µ—Ö 3 –¥–æ–º–µ–Ω–æ–≤
5. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx
6. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç Nginx —Å SSL
7. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç Certbot –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
curl -I https://app.domain.com
curl -I https://edt.domain.com
curl -I https://minio.domain.com

# –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```

## üìñ –ú–µ–Ω—é —Å–∫—Ä–∏–ø—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `sudo ./generate_ssl.sh` –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø—Ü–∏–∏:

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

- **[1] üîê –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (Let's Encrypt)**
  - –ü–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö 3 –¥–æ–º–µ–Ω–æ–≤
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç nginx –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç standalone —Ä–µ–∂–∏–º Certbot
  
- **[2] üìù –ì–µ–Ω–µ—Ä–∞—Ü–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx**
  - –°–æ–∑–¥–∞–µ—Ç `config/nginx.conf` –¥–ª—è 3 –¥–æ–º–µ–Ω–æ–≤
  - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç upstream –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
  - –î–æ–±–∞–≤–ª—è–µ—Ç SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

- **[3] üåê –ó–∞–ø—É—Å–∫ nginx**
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx —Å SSL
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç healthcheck
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å worker process

- **[4] üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx**
  - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ —É–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä nginx

- **[5] üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ nginx**
  - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç nginx –∑–∞–Ω–æ–≤–æ
  - –ü–æ–ª–µ–∑–Ω–æ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **[6] üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤**
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å nginx (—Å healthcheck)
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å certbot
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö
  - –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä—Ç—ã

- **[7] üìã –õ–æ–≥–∏ nginx**
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ nginx

- **[8] üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx**
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç `nginx -t` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

- **[99] üöÄ –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (SSL + nginx)**
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ —à–∞–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç nginx –∏ certbot
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

- **[0] üö™ –í—ã—Ö–æ–¥**

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Nginx

### Upstream –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```nginx
# App Server (UnicChat)
upstream app_server {
    server unicchat.appserver:3000;
}

# Document Server (OnlyOffice)
upstream doc_server {
    server unicchat.documentserver:80;
}

# MinIO S3 API
upstream minio_server {
    server unicchat.minio:9000;
}

# MinIO Console
upstream minio_console {
    server unicchat.minio:9002;
}
```

### –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ö–æ—Å—Ç—ã

| –î–æ–º–µ–Ω | Upstream | –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|------|------------|
| `app.domain.com` | unicchat.appserver:3000 | 443 | –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| `edt.domain.com` | unicchat.documentserver:80 | 443 | OnlyOffice DocumentServer |
| `minio.domain.com` | unicchat.minio:9000 | 443 | MinIO S3 API |
| `minio.domain.com` | unicchat.minio:9002 | 9002 | MinIO Web Console |

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- ‚úÖ **HTTP/2** –≤–∫–ª—é—á–µ–Ω (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `http2 on;`)
- ‚úÖ **CORS headers** –¥–ª—è App Server
- ‚úÖ **WebSocket** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è App Server
- ‚úÖ **Large file uploads** –¥–ª—è MinIO (500MB)
- ‚úÖ **SSL/TLS** —Å A+ —Ä–µ–π—Ç–∏–Ω–≥–æ–º
- ‚úÖ **HTTP ‚Üí HTTPS** —Ä–µ–¥–∏—Ä–µ–∫—Ç –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `unicchat.certbot` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã **–∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤**
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã **–∑–∞ 30 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è**
- –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã **90 –¥–Ω–µ–π**

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Certbot:

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker ps | grep certbot

# –õ–æ–≥–∏
docker logs unicchat.certbot

# –°–ø–∏—Å–æ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
docker exec unicchat.certbot certbot certificates
```

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç—ã 80/443 –∑–∞–Ω—è—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç—ã
sudo ss -tulpn | grep -E ':(80|443)'

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å nginx
cd nginx
sudo ./generate_ssl.sh
# –í—ã–±–µ—Ä–∏—Ç–µ [4] –û—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: DNS –Ω–µ —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DNS –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
dig app.domain.com +short
dig edt.domain.com +short
dig minio.domain.com +short

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
nslookup app.domain.com 8.8.8.8
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å SSL

**–ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **DNS –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
   ```bash
   dig app.domain.com +short
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
   ```

2. **–ü–æ—Ä—Ç 80 –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ**
   ```bash
   # –° –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
   curl http://app.domain.com
   ```

3. **Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—ã**
   ```bash
   sudo ufw status
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   ```

4. **Cloud provider Security Groups**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   - –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã 80 –∏ 443 –≤ Security Groups

5. **Email –Ω–µ —É–∫–∞–∑–∞–Ω**
   ```bash
   # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç email –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   # –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª:
   echo "EMAIL=your@email.com" >> ../unicchat_config.txt
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs unicchat.nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker exec unicchat.nginx nginx -t

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å healthcheck
docker inspect unicchat.nginx | grep -A 10 Health

# –ß–µ—Ä–µ–∑ –º–µ–Ω—é
cd nginx
sudo ./generate_ssl.sh
# [7] –õ–æ–≥–∏ nginx
# [8] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### –ü—Ä–æ–±–ª–µ–º–∞: Healthcheck unhealthy

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å worker process
docker exec unicchat.nginx ps aux | grep nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec unicchat.nginx netstat -tuln | grep -E ':(80|443)'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx
cd nginx
sudo ./generate_ssl.sh
# [5] –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
ls -la ssl/live/*/

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ
cd nginx
sudo ./generate_ssl.sh
# [1] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```

### –ü—Ä–æ–±–ª–µ–º–∞: Permission denied

```bash
# –í—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
chmod +x generate_ssl.sh

# –ó–∞–ø—É—Å–∫–∞—Ç—å —Å sudo
sudo ./generate_ssl.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ .git
ls -la ../.git
```

## üìù –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

### –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–≤–∫–ª—é—á–µ–Ω—ã –≤ git)

```
nginx/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ generate_ssl.sh
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ ssl/
    ‚îî‚îÄ‚îÄ options-ssl-nginx.conf  # SSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (Mozilla SSL Config)
```

### –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–Ω–µ –≤ git)

```
nginx/
‚îú‚îÄ‚îÄ ssl/
‚îÇ   ‚îú‚îÄ‚îÄ ssl-dhparams.pem        # DH parameters 2048 bit (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ live/                   # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.domain.com/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ fullchain.pem   # –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ privkey.pem     # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ accounts/               # Let's Encrypt –∞–∫–∫–∞—É–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ archive/                # –ê—Ä—Ö–∏–≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ renewal/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ www/                        # Let's Encrypt challenges
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf              # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ logs/                       # –õ–æ–≥–∏ nginx (Docker volume)
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `../dns_config.txt` - DNS –∏–º–µ–Ω–∞ (—Å–æ–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `unicchat.sh`)
- `../unicchat_config.txt` - Email –¥–ª—è SSL (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `docker-compose.yml` - Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `.gitignore` - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ò—Å–∫–ª—é—á–µ–Ω–æ –∏–∑ git (.gitignore)

```
ssl/*                           # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –∫–ª—é—á–∏ (–∫—Ä–æ–º–µ options-ssl-nginx.conf)
!ssl/options-ssl-nginx.conf     # –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: SSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ git
www/                            # Challenge —Ñ–∞–π–ª—ã
config/nginx.conf               # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config/*.conf                   # –í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
*.log                           # –õ–æ–≥–∏
```

**–ü–æ—á–µ–º—É `ssl-dhparams.pem` –Ω–µ –≤ git:**
- DH parameters –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ (–∑–∞–Ω–∏–º–∞–µ—Ç 1-2 –º–∏–Ω—É—Ç—ã)
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ–±–æ–ª—å—à–æ–π (~400 –±–∞–π—Ç), –Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–ª—É—á–∞–π–Ω—ã–º

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å** SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏
2. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø** –∫ —Ñ–∞–π–ª–∞–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (600/700)
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å** Docker –æ–±—Ä–∞–∑—ã
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å firewall** –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UnicChat

### –ü–æ—Ä—è–¥–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. **–°–Ω–∞—á–∞–ª–∞** —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ UnicChat —á–µ—Ä–µ–∑ `unicchat.sh`:
   ```bash
   cd /path/to/unicchat.enterprise
   sudo ./unicchat.sh
   # [99] Full automatic setup
   ```

2. **–ó–∞—Ç–µ–º** –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx –∏ SSL:
   ```bash
   cd nginx
   sudo ./generate_ssl.sh
   # [99] –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ—É—Å—Ç–∞–Ω–æ–≤–∫–∞
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Docker —Å–µ—Ç—å
docker network inspect unicchat-network

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏
docker ps --format "table {{.Names}}\t{{.Networks}}"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å upstream
docker exec unicchat.nginx curl -I http://unicchat.appserver:3000
docker exec unicchat.nginx curl -I http://unicchat.documentserver:80
docker exec unicchat.nginx curl -I http://unicchat.minio:9000
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Nginx](https://nginx.org/ru/docs/)
- [Let's Encrypt](https://letsencrypt.org/docs/)
- [Certbot](https://eff-certbot.readthedocs.io/)
- [Docker Compose](https://docs.docker.com/compose/)
- [HTTP/2 –≤ Nginx](https://nginx.org/en/docs/http/ngx_http_v2_module.html)

---

**–í–µ—Ä—Å–∏—è**: 2.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2026-01-23  
**–ê–≤—Ç–æ—Ä**: UnicChat Team
